---
  - name: Create Ansible Service Account
    hosts: all
    gather_facts: yes
    vars:
       ansible_svc_account: "{{ ansible_svc_account }}"
       ansible_home_directory: "{{ ansible_home_directory }}"

    tasks:
    
    - name: 'Preflight Varible check :: ansible_svc_account'
      fail: msg='Please include the ansible_svc_account to the variable "ansible_svc_account"'
      run_once: true
      when: 'ansible_svc_account is not defined'
      
    - name: 'Preflight Varible check :: ansible_home_directory'
      fail: msg='Please include the user_name to the variable "ansible_home_directory"'
      run_once: true
      when: 'ansible_home_directory is not defined'
     
    - name: Creating the "{{ ansible_svc_account }}" user account and the "{{ ansible_home_directory }}/{{ ansible_svc_account }}" home directory
      user:
        name: "{{ ansible_svc_account }}"
        home: "{{ ansible_home_directory }}/{{ ansible_svc_account }}"
        create_home: true
        comment: Service account for Ansible
        state: present
        remove: false
        system: true
